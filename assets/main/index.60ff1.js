window.__require=function t(e,i,r){function o(s,a){if(!i[s]){if(!e[s]){var c=s.split("/");if(c=c[c.length-1],!e[c]){var h="function"==typeof __require&&__require;if(!a&&h)return h(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var p=i[s]={exports:{}};e[s][0].call(p.exports,function(t){return o(e[s][1][t]||t)},p,p.exports,t,e,i,r)}return i[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<r.length;s++)o(r[s]);return o}({AStarMoveType:[function(t,e){"use strict";cc._RF.push(e,"d8b5aOv2ydICLvN0ax2hzqs","AStarMoveType");var i=cc.Enum({FOUR_DIRECTION:-1,EIGHT_DIRECTION:-1});e.exports=i,cc._RF.pop()},{}],AStarStep:[function(t,e){"use strict";cc._RF.push(e,"cddcfi9HolIJqBlrTmLMDgD","AStarStep");var i=cc.Class({properties:function(){return{g:{default:0,type:cc.Integer},h:{default:0,type:cc.Integer},f:{get:function(){return this.g+this.h}},position:{default:new cc.Vec2},last:{default:null,type:i,serializable:!1}}},ctor:function(){arguments.length>0&&arguments[0]instanceof cc.Vec2&&(this.position=arguments[0])},equalTo:function(t){return t instanceof i&&this.position.equals(t.position)},toString:function(){return"(position: "+this.position+" g: "+this.g+" h: "+this.h+" f: "+this.f+")"}});e.exports=i,cc._RF.pop()},{}],AStar:[function(t,e){"use strict";cc._RF.push(e,"c6b32yKT3RKT7HVcYN3ryNr","AStar");var i=t("AStarStep"),r=t("AStarMoveType");cc.Class({extends:cc.Component,properties:{barrierLayerName:"barrier",moveType:{default:r.FOUR_DIRECTION,type:r}},editor:{requireComponent:cc.TiledMap},onLoad:function(){this._open=[],this._closed=[]},start:function(){this._tiledMap=this.getComponent(cc.TiledMap),this._layerBarrier=this._tiledMap.getLayer(this.barrierLayerName)},_indexOfStepArray:function(t,e){for(var i=0;i<e.length;++i)if(t.equals(e[i].position))return i;return-1},_insertToOpen:function(t){for(var e=t.f,i=this._open.length,r=0;r<i&&!(e<=this._open[r].f);++r);this._open.splice(r,0,t)},moveToward:function(t,e){this._closed=[],this._open=[];var r=[];this._open.push(new i(t));do{var o=this._open.shift();if(this._closed.push(o),o.position.equals(e)){var n=o;do{r.unshift(n.position),n=n.last}while(null!==n);this._open=[],this._closed=[];break}for(var s=this._borderMovablePoints(o.position),a=0;a<s.length;++a){var c=s[a];if(-1==this._indexOfStepArray(c,this._closed)){var h=new i(c),p=this._costToMove(c,e),l=this._indexOfStepArray(c,this._open);if(-1==l){h.last=o,h.g=o.g+p;var u=c.sub(e);h.h=Math.abs(u.x)+Math.abs(u.y),this._insertToOpen(h)}else h=this._open[l],o.g+p<h.g&&(h.g=o.g+p,this._open.splice(l,1),this._insertToOpen(h))}else s.splice(a,1),a--}}while(this._open.length>0);return r},_costToMove:function(t,e){return this.moveType==r.EIGHT_DIRECTION?t.x!=e.x&&t.y!=e.y?14:10:1},_borderMovablePoints:function(t){var e=[],i=!1,o=!1,n=!1,s=!1,a=cc.v2(t.x,t.y-1);0===this._layerBarrier.getTileGIDAt(a)&&(e.push(a),i=!0);var c=cc.v2(t.x,t.y+1);0===this._layerBarrier.getTileGIDAt(c)&&(e.push(c),o=!0);var h=cc.v2(t.x-1,t.y);0===this._layerBarrier.getTileGIDAt(h)&&(e.push(h),n=!0);var p=cc.v2(t.x+1,t.y);if(0===this._layerBarrier.getTileGIDAt(p)&&(e.push(p),s=!0),this.moveType==r.EIGHT_DIRECTION){var l=cc.v2(t.x-1,t.y-1);i&&n&&0===this._layerBarrier.getTileGIDAt(l)&&e.push(l);var u=cc.v2(t.x+1,t.y-1);i&&s&&0===this._layerBarrier.getTileGIDAt(u)&&e.push(u);var _=cc.v2(t.x-1,t.y+1);o&&n&&0===this._layerBarrier.getTileGIDAt(_)&&e.push(_);var g=cc.v2(t.x+1,t.y+1);o&&s&&0===this._layerBarrier.getTileGIDAt(g)&&e.push(g)}return e}}),cc._RF.pop()},{AStarMoveType:"AStarMoveType",AStarStep:"AStarStep"}],AuthorFooter:[function(t,e){"use strict";cc._RF.push(e,"654b5eiPftHcb6FO/XlY7qk","AuthorFooter"),cc.Class({extends:cc.Component,openAuthor:function(){cc.sys.openURL(this._appendSubPath("https://github.com/","ty0x2333"))},openRepo:function(){cc.sys.openURL(this._appendSubPath("https://github.com/","ty0x2333","A-star"))},_appendSubPath:function(t){if(arguments.length<2)return"/"===t[t.length-1]?t:t+"/";for(var e=t,i=1;i<arguments.length;++i)e+=arguments[i]+"/";return e}}),cc._RF.pop()},{}],TestMap:[function(t,e){"use strict";cc._RF.push(e,"c2e92irXu1PCYYXIRuBp3hR","TestMap");var i=t("AStar"),r=t("AStarMoveType");cc.Class({extends:cc.Component,properties:{floorLayerName:"floor",playerStart:{default:new cc.v2},stepOfDuration:{default:.2,type:cc.Float},enabledDebugDraw:!0},editor:{requireComponent:i},onLoad:function(){this._debugTileColor=cc.color(255,187,255,255),this._paths=[]},onModeSwitchButtonClicked:function(t){var e=t.target.getComponentInChildren(cc.Label);this._aStar.moveType===r.FOUR_DIRECTION?(this._aStar.moveType=r.EIGHT_DIRECTION,e.string="8 direction"):(this._aStar.moveType=r.FOUR_DIRECTION,e.string="4 direction")},start:function(){this._player=this.node.getChildByName("player"),this._aStar=this.getComponent(i),this._tiledMap=this.getComponent(cc.TiledMap),this._layerFloor=this._tiledMap.getLayer(this.floorLayerName);var t=this._tiledMap.getTileSize(),e=this._layerFloor.getPositionAt(this.playerStart);e.x+=t.width/2,e.y+=t.width/2,this._player.setPosition(e);var r=this;r._tiledMap.node.on(cc.Node.EventType.TOUCH_END,function(t){var e=t.getTouches()[0].getLocation(),i=r.node.convertToNodeSpaceAR(e),o=r._tilePosistion(i),n=r._layerFloor.getLayerSize();if(o.x<0||o.x>=n.width||o.y<0||o.y>=n.height)return!0;var s=r._player.getPosition();cc.log("player position: "+s);var a=r._tilePosistion(s);return cc.log("player tile position: "+a),r._move(a,o),r._debugDraw(o,cc.Color.RED),!0},r.node)},_move:function(t,e){if(this._player.stopAllActions(),this.enabledDebugDraw&&this._clearDebugColor(),this._paths=this._aStar.moveToward(t,e),this._paths.length<1)cc.log("cannot find path");else{for(var i=0;i<this._paths.length;++i)this._debugDraw(this._paths[i],this._debugTileColor,i);for(var r=[],o=this._tiledMap.getTileSize(),n=0;n<this._paths.length;++n){var s=this._layerFloor.getPositionAt(this._paths[n]);s.x+=o.width/2,s.y+=o.width/2,r.push(cc.moveTo(this.stepOfDuration,s))}this._player.runAction(cc.sequence(r))}},_clearDebugColor:function(){for(var t=0;t<this._paths.length;++t){var e=this._paths[t];this._layerFloor.getTiledTileAt(e.x,e.y,!0).node.color=cc.Color.WHITE}},_debugDraw:function(t,e){if(this.enabledDebugDraw){var i=this._layerFloor.getTiledTileAt(t.x,t.y,!0);cc.log(i),i.node.color=e}},_tilePosistion:function(t){var e=this.node.getContentSize(),i=this._tiledMap.getTileSize(),r=Math.floor(t.x/i.width),o=Math.floor((e.height-t.y)/i.height);return cc.v2(r,o)}}),cc._RF.pop()},{AStar:"AStar",AStarMoveType:"AStarMoveType"}],"use_v2.0.x_cc.Toggle_event":[function(t,e){"use strict";cc._RF.push(e,"27a052b6i1Fwp/UuZycE4Lb","use_v2.0.x_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_check=!0),cc._RF.pop()},{}]},{},["AStar","AStarMoveType","AStarStep","AuthorFooter","TestMap","use_v2.0.x_cc.Toggle_event"]);